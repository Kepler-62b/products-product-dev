let $name=document.querySelector("input[data-lang='product_form_trans_"+$lang+"']");if($name){$name.addEventListener("input",catUrl.debounce(500));function catUrl(){document.getElementById("product_form_info_url").value=translitRuEn(this.value).toLowerCase()}}let $blockCollectionOffers=document.getElementById("collection-offer");let $addButtonOffer=document.getElementById("offer_addCollection");if($addButtonOffer){$addButtonOffer.addEventListener("click",function(){$addButtonOffer=this;let newForm=$addButtonOffer.dataset.prototype;let index=$addButtonOffer.dataset.index*1;let offer=$addButtonOffer.dataset.offer*1;newForm=newForm.replace(/__offers__/g,index);let div=document.createElement("div");div.classList.add("card");div.classList.add("mb-3");div.classList.add("item-collection-offer");div.dataset.index=offer.toString();div.id="item-collection-offers-"+index;div.innerHTML=newForm;$blockCollectionOffers.append(div);$addButtonOffer.dataset.index=(index+1).toString();div.querySelectorAll(".item-collection-offer-fields").forEach(function(references){let $addButtonMultipleOffer=references.querySelector("[data-reference]");if($addButtonMultipleOffer){replaceReference(references,$addButtonMultipleOffer.dataset.reference)}});replaceHidden(div);div.querySelector(".del-item-offer").addEventListener("click",function(){this.closest(".item-collection-offer").remove()});div.querySelectorAll(".offer_multiple_addCollection").forEach(function(multipleOffer){addMultipleOffer(multipleOffer)});let offer_photo_addCollection=div.querySelector(".offer_photo_addCollection");if(offer_photo_addCollection){offer_photo_addCollection.addEventListener("click",function(){addOfferPhoto(this)})}new KTImageInput(div.querySelector("[data-kt-image-input]"))})}document.querySelectorAll(".del-item-offer").forEach(function(delOffer){delOffer.addEventListener("click",function(){this.closest(".item-collection-offer").remove()})});document.querySelectorAll(".offer_multiple_addCollection").forEach(function(multipleOffer){addMultipleOffer(multipleOffer)});document.querySelectorAll(".item-collection-photo").forEach(function(div){div.querySelector(".change-root").addEventListener("change",function(){this.closest(".item-collection").querySelectorAll(".change-root").forEach(function(rootCheck){rootCheck.checked=false});this.checked=true})});let $offer_photo_addCollection=document.querySelectorAll(".offer_photo_addCollection");$offer_photo_addCollection.forEach(function(addPhoto){addPhoto.addEventListener("click",function(){addOfferPhoto(this)})});document.querySelectorAll(".del-item-offer-image").forEach(function(deletePhoto){deletePhoto.addEventListener("click",function(){this.closest(".item-collection-photo").remove()})});document.querySelectorAll(".del-item-collection").forEach(function(deleteMulti){deleteMulti.addEventListener("click",function(){if(this.closest(".multiple-collection").querySelectorAll(".del-item-collection").length>1){this.closest(".item-collection").remove()}})});function addMultipleOffer($addButtonMultipleOffer){$addButtonMultipleOffer.addEventListener("click",function(){let $multipleBlock=document.getElementById("multiple_"+$addButtonMultipleOffer.dataset.collection);let newForm=$addButtonMultipleOffer.dataset.prototype;let offers=$addButtonMultipleOffer.dataset.offers*1;let $blockCollectionOffers=document.getElementById("item-collection-offers-"+offers);let index=$blockCollectionOffers.dataset.index*1;newForm=newForm.replace(/__offers__/g,offers);newForm=newForm.replace(/__variation__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.removeAttribute("id");div.classList.add("pt-3");div.classList.add("border-top");div.classList.add("item-collection");div.id="prototype_product_form_offers_"+offers+"_offer_"+index;$multipleBlock.append(div);$blockCollectionOffers.dataset.index=(index+1).toString();replaceHidden($multipleBlock);replaceReference($multipleBlock,$addButtonMultipleOffer.dataset.replace);div.querySelectorAll(".del-item-collection").forEach(function(deleteMulti){deleteMulti.addEventListener("click",function(){if(this.closest(".multiple-collection").querySelectorAll(".del-item-collection").length>1){this.closest(".item-collection").remove()}})});let newOffer=document.getElementById(div.id);let $offer_photo_addCollection=newOffer.querySelector(".offer_photo_addCollection");if($offer_photo_addCollection){$offer_photo_addCollection.addEventListener("click",function(){addOfferPhoto(this)})}})}function replaceHidden($multipleBlock){$multipleBlock.querySelectorAll("[data-variant]").forEach(function(item){let $variant=document.getElementById(item.dataset.variant);if($variant){item.value=$variant.value;item.removeAttribute("data-variant")}})}function replaceReference($searchBlock,$id){let dupNode=document.getElementById($id);if(dupNode){$searchBlock.querySelectorAll("[data-reference]").forEach(function(item){let cloneNode=dupNode.cloneNode(true);cloneNode.id=item.id;cloneNode.name=item.name;cloneNode.value="";if(cloneNode.options!==undefined){cloneNode.options[0].selected=true;cloneNode.options[0].selected="selected";cloneNode.selectedIndex=0;for(let i=0,l=cloneNode.options.length;i<l;i++){cloneNode.options[i].removeAttribute("selected");cloneNode.options[i].selected=false}}item.replaceWith(cloneNode);if(cloneNode.dataset.select==="select2"){new NiceSelect(cloneNode,{searchable:true})}})}}function addOfferPhoto($addBtn){let $offerImageBlock=document.getElementById($addBtn.dataset.collection);let newForm=$addBtn.dataset.prototype;let index=$addBtn.dataset.index*1;let offers=$addBtn.dataset.offers*1;let offer=$addBtn.dataset.offer*1;newForm=newForm.replace(/__offers__/g,offers);newForm=newForm.replace(/__variation__/g,offer);newForm=newForm.replace(/__images__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.classList.add("image-input");div.classList.add("mb-3");div.classList.add("item-collection-photo");$offerImageBlock.append(div);$addBtn.dataset.index=$addBtn.dataset.index=(index+1).toString();new KTImageInput(div);div.querySelector(".del-item-offer-image").addEventListener("click",function(){this.closest(".item-collection-photo").remove();let index=$addBtn.dataset.index;$addBtn.dataset.index=(index-1).toString()});div.querySelector(".change-root").addEventListener("change",function(){$offerImageBlock.querySelectorAll(".change-root").forEach(function(rootCheck){rootCheck.checked=false});this.checked=true})}