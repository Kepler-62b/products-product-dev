{% trans_default_domain 'product.product' %}


{# <div {{ offer.addMultipleOffer is defined ? 'class="item-collection-offer-fields-multiple" id=multiple_'~offer.vars.id : '' }}> #}

{% if section is null or section != offer.vars.data.offer.value %}

	{% if section is not null and section != offer.vars.data.offer.value %}

		</div>
		</div>
	{% endif %}

{# ????????? #}
{# </div> #}

<div class="card mb-3 mx-3 item-collection-offer-fields">

	<div class="card-header min-h-10px">
		<div class="card-title">
			<h4>
				{{ offer.value.vars.label }}
			</h4>
		</div>
	</div>

	<div class="card-body pb-0 {{ offer.addMultipleOffer is defined ? 'multiple-collection' }}" {{ offer.addMultipleOffer is defined ? 'id=multiple_'~offer.vars.id }}
		 data-index="{{ offers.count }}">

		{% endif %}

		<div class="pt-3 border-top item-collection" id="prototype_{{ offer.vars.id }}">

			{# ЕСЛИ ЗАГРУЗКА ПОЛЬЗЬЗОВАТЕЛЬСКОГО ИЗОБРАЖЕНИЯ #}

			{% if offer.images is defined %}

				<div class="card-header mb-5">
					<div class="card-title d-flex justify-content-between w-100">

						<h5>
							{# Торговое предложение #}
							Фото торгового предложения
						</h5>

						<div>
							{# Добавить фото в торговое предложение #}
							<button type="button"
									class="btn btn-sm btn-light-primary offer_photo_addCollection"
									data-event="add-images"
									data-collection="images_{{ offer.vars.id }}"
									data-offers="{{ offers.vars.name }}"
									data-offer="{{ loop.index0 }}"
									data-index="{{ offer.images.count }}"
									data-prototype="{{ include(_self|replace({ "_offer.html.twig": "prototype.offer.image.html.twig" }))|e('html_attr') }}"
							>

								<span class="svg-icon svg-icon-2">
									<svg
											xmlns="http://www.w3.org/2000/svg"
											width="24"
											height="24"
											viewBox="0 0 24 24"
											fill="none"
									>
										<rect opacity="0.5"
											  x="11"
											  y="18"
											  width="12"
											  height="2"
											  rx="1"
											  transform="rotate(-90 11 18)"
											  fill="black"
										></rect>
										<rect x="6"
											  y="11"
											  width="12"
											  height="2"
											  rx="1"
											  fill="black"
										></rect>
									</svg>
								</span>
								Добавить фото
							</button>
						</div>
					</div>
				</div>


				<div class="d-flex gap-10" id="images_{{ offer.vars.id }}">

					{% for image in offer.images %}
						<div class="image-input mb-3 item-collection-photo"
							 data-kt-image-input="true"
						>

							{% set img_path = image.vars.data.cdn is defined and image.vars.data.cdn == true ? cdn_host : '' %}
							{% set img_min = image.vars.data.cdn is defined and image.vars.data.cdn == true ? 'small.' : '' %}

							{# <div class="image-input-wrapper w-150px h-200px"
								 style="
										 background-size: contain;
										 background-color: #F8FBFF;
										 background-position: center;
										 background-image: url({{ image.vars.data.name is defined and image.vars.data.name is not null ?
								 img_path ~ product_offer_image_dir ~ image.vars.data.dir ~'/'~ image.vars.data.name ~'.'~ img_min ~ image.vars.data.ext  : '/img/blank.svg' }})"
							> #}

							<div class="image-input-wrapper w-150px h-200px lazy"
								 data-bg="{{ image.vars.data.name is defined and image.vars.data.name is not null ?
								 img_path ~ product_offer_image_dir ~ image.vars.data.dir ~'/'~ image.vars.data.name ~'.'~ img_min ~ image.vars.data.ext  : '/img/blank.svg' }}">

							</div>

							<label class="btn btn-icon position-absolute top-0 start-100 translate-middle p-2 border w-25px h-25px bg-body border-light rounded-circle shadow"
								   data-kt-image-input-action="change">

								<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10"
									 fill="currentColor"
									 class="bi bi-pen-fill position-absolute" viewBox="0 0 16 16">
									<path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001z" />
								</svg>

								{# Общие фото торгового предложения #}
								{{ form_row(image.file, { 'attr'  : { 'class' : 'd-none' } }) }}

								<input type="hidden" name="avatar_remove" value="0">

							</label>

							<button type="button"
									class="btn btn-circle btn-icon pb-3 w-25px h-25px bg-body shadow del-item-offer-image float-end"
									style="margin: -1rem -1rem;">
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
									 class="bi bi-trash3-fill mt-3" viewBox="0 0 16 16">
									<path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5ZM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"></path>
								</svg>
							</button>

							<div class="mt-3">
								{{ form_row(image.root, { label: 'Главное фото',  attr  : { 'class' : 'change-root' } }) }}
							</div>
						</div>

					{% endfor %}

				</div>

				<div class="ms-5 my-3 text-muted">
					<small>Первое фото используется для обложки, остальные для галереи торгового
						предложения</small>
				</div>

			{% endif %}




			{# Артикул торгового предложения #}
			{% if offer.article is defined %}
				{{ form_row(offer.article, { label: 'Артикул торгового предложения'  }) }}
			{% endif %}

			<div class="d-flex justify-content-between gap-3">

				{% if offer.deleteMultipleOffer is defined %}

					<div class="{{ idMultiple == offer.vars.id ? 'd-none' : 'd-block' }}">

						{{ form_row(offer.deleteMultipleOffer,
							{
								label: '<span class="svg-icon svg-icon-2">
									<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
										<rect opacity="0.5" x="7.05025" y="15.5356" width="12" height="2" rx="1" transform="rotate(-45 7.05025 15.5356)" fill="black"></rect>
										<rect x="8.46447" y="7.05029" width="12" height="2" rx="1" transform="rotate(45 8.46447 7.05029)" fill="black"></rect>
									</svg>
								</span>'
							} ) }}
					</div>
				{% endif %}

				<div class="w-100 mb-3">

					{# {{ dump(offer.value.vars.data) }} #}

					{# Скрытый ID поля #}
					{{ form_widget(offer.offer) }}
					{{ form_widget(offer.value, { attr: { placeholder: offer.value.vars.label, class: 'offer_value_reference' } }) }}
				</div>

				{% if offer.price is defined %}

					<div class="input-group mb-5">

						<span class="input-group-text"
							  id="basic-addon3"
						>
							<svg xmlns="http://www.w3.org/2000/svg"
								 width="16"
								 height="16"
								 fill="currentColor"
								 class="bi bi-currency-exchange"
								 viewBox="0 0 16 16"
							>
								<path d="M0 5a5.002 5.002 0 0 0 4.027 4.905 6.46 6.46 0 0 1 .544-2.073C3.695 7.536 3.132 6.864 3 5.91h-.5v-.426h.466V5.05c0-.046 0-.093.004-.135H2.5v-.427h.511C3.236 3.24 4.213 2.5 5.681 2.5c.316 0 .59.031.819.085v.733a3.46 3.46 0 0 0-.815-.082c-.919 0-1.538.466-1.734 1.252h1.917v.427h-1.98c-.003.046-.003.097-.003.147v.422h1.983v.427H3.93c.118.602.468 1.03 1.005 1.229a6.5 6.5 0 0 1 4.97-3.113A5.002 5.002 0 0 0 0 5zm16 5.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0zm-7.75 1.322c.069.835.746 1.485 1.964 1.562V14h.54v-.62c1.259-.086 1.996-.74 1.996-1.69 0-.865-.563-1.31-1.57-1.54l-.426-.1V8.374c.54.06.884.347.966.745h.948c-.07-.804-.779-1.433-1.914-1.502V7h-.54v.629c-1.076.103-1.808.732-1.808 1.622 0 .787.544 1.288 1.45 1.493l.358.085v1.78c-.554-.08-.92-.376-1.003-.787H8.25zm1.96-1.895c-.532-.12-.82-.364-.82-.732 0-.41.311-.719.824-.809v1.54h-.005zm.622 1.044c.645.145.943.38.943.796 0 .474-.37.8-1.02.86v-1.674l.077.018z" />
							</svg>
						</span>

						{{ form_widget(offer.price.price, { attr: { 'placeholder' : 'Стоимость' } }) }}

					</div>

					<div class="w-50">{{ form_row(offer.price.currency) }}</div>

				{% endif %}


				{% if offer.quantity is defined %}
					<div class="w-50">
						{{ form_row(offer.quantity.quantity, { attr: { placeholder: 'Наличие'|trans } }) }}
					</div>
					<div class="w-75">
						{{ form_row(offer.quantity.reserve, { attr: { placeholder: 'Зарезервированно'|trans } }) }}
					</div>

				{% endif %}

			</div>

		</div>

		{% if offer.price is defined or offer.addMultipleOffer is defined %}




		{% if addMultiple or addPrice %}

	</div>

	<div class="card-footer px-3 pb-0 pt-3">

		<div class="d-flex w-100 justify-content-between">

			{% if offer.addMultipleOffer is defined %}

				<div class="{{ addMultiple ? 'd-block' : 'd-none' }}">

					{# Кнопка Добавить множественное поле торгового предложеия #}
					{{ form_row(offer.addMultipleOffer,
						{
							label: '<span class="svg-icon svg-icon-2">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
							<rect opacity="0.5" x="11" y="18" width="12" height="2" rx="1" transform="rotate(-90 11 18)" fill="black"></rect>
							<rect x="6" y="11" width="12" height="2" rx="1" fill="black"></rect>
						</svg>
					</span>'~'Добавить '~ offer.value.vars.label,
							attr:
							{
								'class' : 'btn btn-sm btn-light-primary offer_multiple_addCollection',
								'data-collection' : idMultiple,
								'data-replace' : idMultipleReplace,
								'data-offers' : offers.vars.name,
								'data-prototype' : include(_self|replace({ "_offer.html.twig": "prototype.offer.html.twig" }))|replace({'__loop__' : loop.index0})
							}
						} ) }}

				</div>
			{% endif %}

			{% if addPrice and offer.price is defined %}
				<div class="ms-5 my-3 text-muted">
					<small>Цена торгового предложения имеет приоритет над базовой ценой. Если поле не заполнено,
						присваивается базовое значение.</small>
				</div>
			{% endif %}

		</div>
	</div>

	{% elseif offer.addMultipleOffer is defined %}
		<div class="d-none">
			{{ form_widget(offer.addMultipleOffer) }}
		</div>
	{% endif %}


	{% endif %}



	{#
	</div> #}

