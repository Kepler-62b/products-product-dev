<?xml version="1.0"?>

{# 'color' => '00BFFF'
  'title' => 'Triangle Tyres Russia - китайские шины Триангл оптом и в розницу'
  'keywords' => 'купить, Триангл, Triangle'
  'description' => 'Купить шины Триангл оптом и в розницу по выгодной цене' #}


{# {{ card.product_name }}
#}{# Значение торгового предложения #}{#
{{ card.product_offer_value|call_twig_func(card.product_offer_reference) }}
#}{# Постфикс торгового предложения #}{#
{{ card.product_offer_postfix }}
#}{# Значение множественного варианта ТП #}{#
{{ card.product_variation_value|call_twig_func(card.product_variation_reference) }}
#}{# Постфикс множественного варианта #}{#
{{ card.product_variation_postfix }}
#}{# Значение модификации множественного варианта ТП #}{#
{{ card.product_modification_value|call_twig_func(card.product_modification_reference) }}
#}{# Постфикс модификации #}{#
{{ card.product_modification_postfix }} #}


<yml_catalog date='{{ 'now'|date('Y-m-d\\TH:00:00P') }}'>
    <shop>
        <name>{{ settings.title }}</name>
        <company>{{ settings.description }}</company>
        <url>{{ absolute_url(path('core:user.homepage')) }}</url>
        <platform>Symfony</platform>
        <version>1.0</version>
        <agency>Технологичные решения</agency>
        <email>example-email@gmail.com</email>


        <categories>
            {% for id, cat in category %}
                <category id='{{ id }}'{{ cat.parent_category ? " parentId='"~cat.parent_category~"'":"" }}>{{ cat.category_name }}</category>
            {% endfor %}

            <category id='1'>Hfpltk</category>
            <category id='10' parentId='1'>Мелкая техника для кухни</category>
            <category id='101' parentId='10'>Сэндвичницы и приборы для выпечки</category>
        </categories>


        <offers>
            {% for card in products %}

                {{ dd(card) }}


                {% set arr_property = card.category_section_field|json_decode %}

                <offer id='{{ card.product_id }}'>
                    <name><name>{{ card.product_name }}

                            {# Значение торгового предложения #}
                            {{ card.offer_value|call_twig_func(card.offer_reference) }}

                            {# Значение множественного варианта ТП #}
                            {{ card.variation_value|call_twig_func(card.variation_reference) ~ card.modification_value|call_twig_func(card.modification_reference) }}</name></name>
                    <vendor>{{ card.product_name }}</vendor>
                    <vendorCode>A1234567B</vendorCode>
                    <categoryId>10</categoryId>
                    {# Обложка  #}
                    {% set image_path = '/assets/img/empty.png' %}

                    {% if card.product_image_ext is defined and card.product_image_ext is not null %}
                        {% set img_host =  card.product_image_cdn == true  ? CDN_HOST : '' %}
                        {% set img_dir = card.product_image %}
                        {% set img_file = (img_host is empty ? '/image.' : '/original.') ~ card.product_image_ext %}
                        {% set image_path = img_host ~ img_dir ~ img_file %}
                    {% endif %}

                    <picture>{{ absolute_url(image_path) }}</picture>
                    <description>
                        <![CDATA[ <h3>Мороженица Brand 3811</h3>
                        <p>Это прибор, который придётся по вкусу всем любителям десертов и сладостей, ведь с его помощью
                            вы сможете делать вкусное домашнее мороженое из натуральных ингредиентов.</p> ]]>
                    </description>
                    <manufacturer_warranty>true</manufacturer_warranty>
                    <country_of_origin>Китай</country_of_origin>
                    <barcode>4601546021298</barcode>

                    {# Свойства, учавствующие в ПРЕВЬЮ #}
                    {% for name_property in arr_property | filter(preview => preview.field_card == true) %}
                        {% set var = name_property.field_value|call_twig_func(name_property.field_type) %}
                        {% if var %}
                            <param name='{{ name_property.field_trans }}'>{{ var }}</param>
                        {% endif %}
                    {% endfor %}

                    <weight>3.6</weight>
                    <dimensions>20.1/20.5/22.5</dimensions>
                    <service-life-days>P2Y</service-life-days>
                    <comment-life-days>Использовать при температуре не ниже -10 градусов.</comment-life-days>
                    <warranty-days>P1Y</warranty-days>
                    <comment-warranty>Гарантия не распространяется на механические повреждения покрытия чаши.
                    </comment-warranty>
                </offer>


            {% endfor %}

        </offers>
    </shop>
</yml_catalog>


<yml_catalog date='{{ 'now'|date('Y-m-d\\TH:00:00P') }}'>
    <shop>
        <name>{{ settings.title }}</name>
        <company>{{ settings.description }}</company>
        <url>{{ absolute_url(path('core:user.homepage')) }}</url>
        <platform>uCoz</platform>

        {# <categories>
            <category id='1'>Бытовая техника</category>
            <category id='10' parentId='1'>Мелкая техника для кухни</category>
            <category id='101' parentId='10'>Сэндвичницы и приборы для выпечки</category>
        </categories> #}

        {# <delivery-options>
            <option cost='200' days='1'/>
        </delivery-options> #}

        {# <pickup-options>
            <option cost='200' days='1'/>
        </pickup-options> #}
        <offers>
            {% for card in products %}

                {{ dd(card) }}


                {% set arr_property = card.category_section_field|json_decode %}



                <offer id='{{ card.product_id }}'>
                    <name>

                        {{ card.product_name }}

                    </name>
                    {# <vendor>Brand</vendor> #}
                    {# <vendorCode>A1234567B</vendorCode> #}
                    <url>{{ absolute_url(path('products-product:user.detail', {
                            url: card.url,
                            offer: card.offer_value,
                            variation: card.variation_value,
                            modification: card.modification_value
                        } )) }}</url>
                    <price>{{ (card.product_price / 100) }}</price>
                    <currencyId>{{ card.product_currency|upper }}</currencyId>
                    {# <oldprice>9990</oldprice> #}
                    {# <enable_auto_discounts>true</enable_auto_discounts> #}

                    {# <categoryId>101</categoryId> #}

                    {# Обложка  #}
                    {% set image_path = '/assets/img/empty.png' %}

                    {% if card.product_image_ext is defined and card.product_image_ext is not null %}
                        {% set img_host =  card.product_image_cdn == true  ? CDN_HOST : '' %}
                        {% set img_dir = card.product_image %}
                        {% set img_file = (img_host is empty ? '/image.' : '/original.') ~ card.product_image_ext %}
                        {% set image_path = img_host ~ img_dir ~ img_file %}
                    {% endif %}

                    <picture>{{ absolute_url(image_path) }}</picture>

                    {# Свойства, учавствующие в ПРЕВЬЮ #}
                    {% for name_property in arr_property | filter(preview => preview.field_card == true) %}
                        {% set var = name_property.field_value|call_twig_func(name_property.field_type) %}
                        {% if var %}
                            <param name='{{ name_property.field_trans }}'>{{ var }}</param>
                        {% endif %}
                    {% endfor %}

                    {# <stock>более 20</stock> #}

                    {# <description>
                    <![CDATA[
                    <p>Это прибор, который придётся по вкусу всем любителям десертов и сладостей</p>
                    <p>С его помощью вы сможете делать вкусное домашнее мороженое из натуральных ингредиентов.</p>
                    ]]>
                </description> #}

                    {# <sales_notes>Необходима предоплата.</sales_notes> #}
                    {# <manufacturer_warranty>true</manufacturer_warranty> #}
                    {# <barcode>4601546021298</barcode> #}
                    {# <param name='Цвет'>белый</param> #}
                    {# <weight>3.6</weight> #}
                    {# <dimensions>20.1/20.551/22.5</dimensions> #}
                    {# <condition type='preowned'>
                    <quality>excellent</quality>
                </condition> #}
                </offer>

            {% endfor %}
        </offers>

    </shop>
</yml_catalog>